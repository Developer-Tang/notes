## 数据不一致

缓存和数据库数据一致性问题：分布式环境下非常容易出现缓存和数据库间数据一致性问题

**解决思路**

1. **延时双删** ：删除缓存-更新数据-延迟休眠-删除缓存
2. **异步延时删除** ：删除缓存-更新数据-删除缓存-异步延时任务删除
3. **异步更新** ：通过 binlog 等机制实现数据全量/增量更新

## 缓存雪崩

缓存在同一时间大面积的失效，从而导致所有的请求都去查数据库，导致数据库CPU和内存负载过高甚至宕机

**解决思路**

1. **限流:** 通过对服务进行限流访问，减少同时打到数据库的流量
2. **分散缓存失效时间:** 设置缓存过期时间时加上随机值，尽可能的将失效时间分散

## 缓存击穿

针对某个热点数据，突然在缓存中失效，然后大量请求涌入到数据库

**解决思路**

1. **永久有效** ：热点数据设置较长的过期时间或永久有效
2. **定时更新** ：定时刷新热点数据过期时间

## 缓存穿透

查询一个不存在的数据。缓存无法命中，需要每次都从数据库中查询，查不到数据则不写入缓存，导致这个不存在的数据每次被请求时都需要去查询数据库，造成缓存穿透

**解决思路**

1. **过滤** ：过滤掉一些明显格式错误的key，或通过布隆过滤器判断要查询的是否存在
2. **存储未命中值:** 当缓存未命中且查询数据库也不存在数据时，在缓存中设置空对象并设置一个较短的过期时间，后续请求不在查询数据库，当有数据及时删除/更新旧的缓存

## 缓存预热

在系统上线后，提前将相关的缓存数据加载到缓存系统中，以避免在用户请求时先查询数据库，然后再将数据缓存的问题。这样，用户可以直接查询事先被预热的缓存数据，从而提高系统的响应速度和性能

**解决思路**

1. **定时刷新** ：通过定时任务实现定时刷新热点数据到缓存
2. **API刷新** ：提供一个缓存刷新接口，需要的时候手动调用或通过管理页面进行调用
3. **启动预热** ：数据量较小时也可以在项目启动时直接加载到缓存中

## 缓存降级

在缓存不可用或无法满足需求时采取的策略，通过改变缓存行为来应对问题，确保应用程序在缓存不可用的情况下仍然能够正常运行，尽管可能会降低性能。这种策略的目的是在保证核心服务可用性的同时，对非核心或次要服务进行降级处理，以减轻系统压力并提高系统的整体稳定性和可用性

**解决思路**

1. **定时刷新** ：通过定时任务实现定时刷新热点数据到缓存
2. **API刷新** ：提供一个缓存刷新接口，需要的时候手动调用或通过管理页面进行调用
3. **启动预热** ：数据量较小时也可以在项目启动时直接加载到缓存中
